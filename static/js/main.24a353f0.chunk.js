(this["webpackJsonpchatting-app"]=this["webpackJsonpchatting-app"]||[]).push([[0],{76:function(e,t,a){},77:function(e,t,a){"use strict";a.r(t);var n=a(22),c=a.n(n),s=a(56),r=a(20),i=a.n(r),o=a(25),l=a(13),u=a(3),j=a.n(u).a.createContext(),d=a(4);function h(e){var t=e.src,a=e.size;return Object(d.jsx)("img",{draggable:!1,className:"avatar ".concat("big"===a&&"big"),alt:"",src:t})}var m=a(97),b=a(95),f=Object(b.a)({chat:{display:"flex",padding:"8px",alignItems:"center",gap:".5rem"},active:{backgroundColor:"var(--color-lightGrey)"}});function v(e){var t=e.email,a=e.name,n=e.thumbnail,c=e.lastMessage,s=e.lastActive,r=e.active,i=e.onSelect,o=a.split(" ")[0],l=c.length<25?c:"".concat(c.slice(0,22),"..."),u="none"!==s?Intl.DateTimeFormat("en-us").format(new Date(s)):"none",j=f();return Object(d.jsxs)(m.a,{className:"".concat(j.chat," ").concat(r&&j.active),onClick:function(){return i(t)},children:[Object(d.jsx)(h,{src:n,size:"big"}),Object(d.jsxs)("div",{className:"chat__content",children:[Object(d.jsxs)("div",{className:"chat__info",children:[Object(d.jsx)("div",{className:"chat__name",children:o}),Object(d.jsx)("div",{className:"u-shadded-text u-small-text",children:l})]}),Object(d.jsx)("div",{className:"chat__info",children:Object(d.jsx)("div",{className:"u-shadded-text u-vSmall-text",children:u})})]})]})}function O(){var e=Object(u.useContext)(j),t=e.user,a=e.chats,n=e.userMessages,c=e.activeChat,s=e.onChatSelect,r=e.parseEmail,i=e.value,o=Object(u.useState)([]),h=Object(l.a)(o,2),m=h[0],b=h[1];return Object(u.useEffect)((function(){a&&b(a.map((function(e,a){var i,o,l,u,j,h,m=e.email,b=e.name,f=e.thumbnail;if(n[r(m)]){var O=n[r(m)].messages;h=O[O.length-1]}return Object(d.jsx)(v,{email:m,name:b,thumbnail:f,lastActive:(null===(i=h)||void 0===i?void 0:i.date)||"none",lastMessage:"".concat((null===(o=h)||void 0===o?void 0:o.content)?(null===(l=h)||void 0===l?void 0:l.provider)===t.email?"You: ".concat(null===(u=h)||void 0===u?void 0:u.content):null===(j=h)||void 0===j?void 0:j.content:"The chat is empty"),active:m===c,onSelect:function(){return s(m)}},a)})))}),[a,c,i]),Object(d.jsx)("div",{className:"chatsList",children:m})}var p=a(99),x=a(98);function g(e){var t=e.listItems,a=e.alignRight;return Object(d.jsx)("div",{className:"dropdown ".concat(a&&"align-right"),children:t.map((function(e,t){return Object(d.jsx)("div",{className:"dropdown__listItem",children:Object(d.jsx)(x.a,{size:"large",onClick:e[1],children:Object(d.jsx)("span",{children:e[0]})})},t)}))})}var N=a(32);function w(){var e=Object(u.useState)(!1),t=Object(l.a)(e,2),a=t[0],n=t[1],c=Object(u.useContext)(j),s=c.user,r=s.email,i=s.name,o=s.thumbnail,m=c.signOut,b=c.addChat;return Object(d.jsxs)("div",{className:"profile",children:[Object(d.jsxs)("div",{className:"profile__info",children:[Object(d.jsx)(h,{src:o}),Object(d.jsx)("h2",{className:"header-secondary",children:i.split(" ")[0]})]}),Object(d.jsxs)("div",{className:"profile__btns",children:[Object(d.jsx)(p.a,{onClick:function(){var e=prompt("The Email Adress...");b(e)},children:Object(d.jsx)(N.a,{fontSize:"large"})}),Object(d.jsxs)("div",{className:"dropdown__group",children:[Object(d.jsx)(p.a,{onClick:function(){return n((function(e){return!e}))},children:Object(d.jsx)(N.b,{fontSize:"large"})}),a&&Object(d.jsx)(g,{listItems:[["Profile",function(){alert("Email Address: ".concat(r," \nFull Name: ").concat(i," "))}],["Sign Out",m]]})]})]})]})}var _=a(48);function y(){return Object(d.jsx)("div",{className:"search",children:Object(d.jsxs)("div",{className:"search__container",children:[Object(d.jsx)(_.a,{className:"search__icon"}),Object(d.jsx)("input",{type:"text",className:"search__input",placeholder:"Search..."})]})})}function S(){return Object(d.jsxs)("div",{className:"sidebar",children:[Object(d.jsx)(w,{}),Object(d.jsx)(y,{}),Object(d.jsx)(O,{})]})}var C=a(103);function k(){var e=Object(u.useContext)(j),t=e.chats,a=e.activeChat,n=e.deleteChat,c=e.resetChat,s=Object(u.useState)(!1),r=Object(l.a)(s,2),i=r[0],o=r[1],m=t.find((function(e){return e.email===a}));return Object(d.jsxs)("div",{className:"header",children:[Object(d.jsx)(h,{src:m.thumbnail}),Object(d.jsxs)("div",{className:"header__content",children:[Object(d.jsx)("div",{className:"header__name",children:m.name}),Object(d.jsxs)("div",{className:"dropdown__group",children:[Object(d.jsx)(p.a,{onClick:function(){return o((function(e){return!e}))},children:Object(d.jsx)(N.b,{fontSize:"large"})}),i&&Object(d.jsx)(g,{listItems:[["Delete Chat",function(){var e=Object(C.a)(),t=prompt("Are you sure that you want to delete this chat?\nPlease re-write ".concat(e," to delete the chat"));e===t&&n(a),e!==t&&alert("The chat won't be deleted as you didn't re-write the code correctly")}],["Reset Chat",function(){var e=Object(C.a)(),t=prompt("Are you sure that you want to Reset this chat?\nPlease re-write ".concat(e," to delete the chat"));e===t&&c(a),e!==t&&alert("The chat won't be reseted as you didn't re-write the code correctly")}]],alignRight:!0})]})]})]})}var I=a(50),E=a(49),A=a.n(E);function M(e){var t=e.content,a=e.you,n=e.date,c=e.divRef,s=e.id,r=Object(u.useState)(!1),i=Object(l.a)(r,2),o=i[0],h=i[1],m=A()(n.toISOString()).fromNow(),b=Object(u.useContext)(j),f=b.deleteMessage,v=b.viewMessageInfo;return Object(d.jsx)("div",{className:"message ".concat(a&&"you"),ref:c,children:Object(d.jsxs)("div",{className:"message__content",children:[Object(d.jsx)("div",{className:"message__date u-vSmall-text",children:m}),t,Object(d.jsxs)("div",{className:"dropdown__group",children:[Object(d.jsx)(p.a,{onClick:function(){return h((function(e){return!e}))},style:{padding:".3rem"},children:Object(d.jsx)(I.a,{fontSize:"small"})}),o&&Object(d.jsx)(g,{listItems:[["Remove message",function(){return f(s)}],["Message Info",function(){return v(s)}]],alignRight:a})]})]})})}var R=a(42),T=a.p+"static/media/ES_Mouth Pop 1 - SFX Producer.d4f98ffd.mp3",P=a.p+"static/media/ES_Mouth Pop 2 - SFX Producer.a92926d3.mp3",D=new R.Howl({src:T,volume:.5}),z=new R.Howl({src:P,volume:.5});function F(){var e=Object(u.useContext)(j),t=e.userMessages,a=e.activeChat,n=t[(0,e.parseEmail)(a)].messages,c=Object(u.useRef)(0),s=Object(u.useRef)(null),r=n.map((function(e){var t=e.id,n=e.content,c=e.date,s=e.provider;return Object(d.jsx)(M,{id:t,content:n,date:new Date(c),you:s!==a},t)})),i=function(){if(s.current){var e=s.current;e.scrollTop=e.scrollHeight}};return Object(u.useEffect)((function(){r.length-1===c.current&&(i(),n[n.length-1].provider===a?D.play():z.play()),c.current=r.length}),[r]),Object(u.useEffect)((function(){i()}),[a]),Object(d.jsx)("div",{className:"messagesList",ref:s,children:r})}var L=a(52),U=a(53),J=a(51),B=a.n(J);function G(){var e=Object(u.useState)(!1),t=Object(l.a)(e,2),a=t[0],n=t[1],c=Object(u.useState)(""),s=Object(l.a)(c,2),r=s[0],i=s[1],o=Object(u.useContext)(j).addMessage;return Object(d.jsxs)("form",{className:"message-form ".concat(a&&"picker-shown"),onSubmit:function(e){e.preventDefault(),o(r),i("")},children:[Object(d.jsx)(B.a,{onEmojiClick:function(e,t){i((function(e){var a=e.split("");return a.push(t.emoji),a.join("")}))}}),Object(d.jsx)(p.a,{onClick:function(){return n((function(e){return!e}))},children:Object(d.jsx)(L.a,{})}),Object(d.jsx)("input",{type:"text",className:"message-form__input",placeholder:"Type a message",value:r,onChange:function(e){return i(e.target.value)}}),Object(d.jsx)(p.a,{type:"submit",children:Object(d.jsx)(U.a,{})})]})}var H=a(38),Y=a(100);function W(e){var t=e.friendsNumber;return Object(d.jsx)("div",{className:"alert",children:Object(d.jsxs)(Y.a,{className:"alert__content",children:[Object(d.jsx)("h2",{className:"header-secondary",children:"Alert"}),Object(d.jsx)("hr",{}),Object(d.jsx)(H.a,{className:"alert__logo"}),t<3?Object(d.jsxs)(d.Fragment,{children:[Object(d.jsxs)("p",{children:["Problem:"," ",t>0&&t<4?"You just have ".concat(t," "):"You have no ",1===t?"friend":"friends"]}),t<4&&Object(d.jsxs)("p",{children:["Need to win some friends go to this"," ",Object(d.jsx)("a",{target:"_blank",href:"https://www.wikihow.com/Make-Friends",rel:"noreferrer",children:"ARTICLE"})]})]}):null,Object(d.jsx)("p",{children:"Please select any chat"})]})})}function X(){var e=Object(u.useContext)(j),t=e.activeChat,a=e.chatsEmails;return Object(d.jsx)("main",{className:"main",children:t&&Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)(k,{}),Object(d.jsx)(F,{}),Object(d.jsx)(G,{})]})||Object(d.jsx)(W,{friendsNumber:a.length})})}var K=a(34);K.a.initializeApp({apiKey:"AIzaSyCt1h_RTazHNrIlUmDns3Fs1aooB_B9jyA",authDomain:"chatty-whatty.firebaseapp.com",databaseURL:"https://chatty-whatty-default-rtdb.firebaseio.com",projectId:"chatty-whatty",storageBucket:"chatty-whatty.appspot.com",messagingSenderId:"227921399269",appId:"1:227921399269:web:4ce87d78bfae535132b30c"});var q=K.a.database(),Q=new K.a.auth.GoogleAuthProvider,V=K.a.auth(),Z=a(55),$=a(78),ee=a(101),te=a(102),ae=Object(b.a)({root:{marginLeft:"10px"}});function ne(e){var t=e.onSignIn,a=e.isLoading,n=e.error,c=ae();return Object(d.jsxs)($.a,{elevation:5,className:"login",children:[n&&Object(d.jsx)(te.a,{severity:"error",children:n}),Object(d.jsx)(H.a,{className:"login__logo"}),Object(d.jsx)("p",{children:"You're not currently SIGNED IN, so SIGN IN first to be able to use the app."}),Object(d.jsxs)(x.a,{variant:"outlined",startIcon:Object(d.jsx)(Z.a,{}),className:"login__btn",onClick:t,children:["Sign In with google",a&&Object(d.jsx)(ee.a,{size:20,className:c.root})]})]})}var ce=function(e){var t=e.split(""),a=e.lastIndexOf("@");return t.slice(0,a).join("")};function se(){var e=Object(u.useState)(),t=Object(l.a)(e,2),a=t[0],n=t[1],c=Object(u.useState)([]),r=Object(l.a)(c,2),h=r[0],m=r[1],b=Object(u.useState)([]),f=Object(l.a)(b,2),v=f[0],O=f[1],p=Object(u.useState)({}),x=Object(l.a)(p,2),g=x[0],N=x[1],w=Object(u.useState)(""),_=Object(l.a)(w,2),y=_[0],k=_[1],I=Object(u.useState)(0),E=Object(l.a)(I,2),A=E[0],M=E[1],R=Object(u.useState)(!1),T=Object(l.a)(R,2),P=T[0],D=T[1],z=Object(u.useState)(null),F=Object(l.a)(z,2),L=F[0],U=F[1];Object(u.useEffect)((function(){Object(o.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:D(!0),V.onAuthStateChanged((function(e){if(console.log(e),e){var t=e.email,a=e.displayName,c=e.photoURL;n({email:t,name:a,thumbnail:c})}else D(!1)}));case 2:case"end":return e.stop()}}),e)})))()}),[]);var J=function(){var e=Object(o.a)(i.a.mark((function e(){var t,a,c,s,r,o,l;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,D(!0),e.next=4,V.signInWithPopup(Q);case 4:t=e.sent,a=t.additionalUserInfo,c=a.isNewUser,s=a.profile,r=s.email,o=s.name,l=s.picture,n({email:r,name:o,thumbnail:l}),c&&q.ref("/users/".concat(ce(r),"/info")).set({email:r,name:o,thumbnail:l}),localStorage.setItem("USER_DATA",JSON.stringify({email:r,name:o,thumbnail:l})),e.next=16;break;case 11:e.prev=11,e.t0=e.catch(0),U(e.t0.message),D(!1),setTimeout((function(){return U(null)}),3e3);case 16:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(){return e.apply(this,arguments)}}();Object(u.useEffect)((function(){return a&&q.ref("/users/".concat(ce(a.email),"/chats")).on("value",(function(e){if(e.val()){var t=Object.keys(e.val()).map((function(e){return"".concat(e,"@gmail.com")}));t.includes(y)||k(""),JSON.stringify(h)!==JSON.stringify(t)&&m(t),N((function(){var t=e.val();return Object.keys(t).map((function(e){return t[e].messages||(t[e].messages=[]),t})),t})),M((function(e){return e+1}))}else k(""),m([])})),function(){a&&q.ref("/users/".concat(ce(a.email),"/chats")).off()}}),[a,y,h]),Object(u.useEffect)((function(){a&&Object(o.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,0!==h.length){e.next=5;break}O([]),e.next=9;break;case 5:return e.next=7,Promise.all(h.map(function(){var e=Object(o.a)(i.a.mark((function e(t){var a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,q.ref("users/".concat(ce(t),"/info")).once("value",(function(e){a=e.val()}));case 2:return e.abrupt("return",a);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 7:t=e.sent,O(t);case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),U("Couldn't fetch user chats");case 14:D(!1);case 15:case"end":return e.stop()}}),e,null,[[0,11]])})))()}),[h]);var B=function(){var e=Object(o.a)(i.a.mark((function e(t){var n,c;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,t!==a.email){e.next=3;break}throw new Error("This is you!");case 3:if(!h.includes(t)){e.next=5;break}throw new Error("User is existed already");case 5:return e.next=7,q.ref("/users/".concat(ce(t),"/info")).once("value",(function(e){e.val()||(n=!1),e.val()&&(n=!0)}));case 7:if(n){e.next=9;break}throw new Error("This user isn't even using or app");case 9:n&&((c={})["/users/".concat(ce(a.email),"/chats/").concat(ce(t))]={isExisted:n,messages:[]},c["/users/".concat(ce(t),"/chats/").concat(ce(a.email))]={isExisted:n,messages:[]},q.ref().update(c)),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),alert(e.t0);case 15:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(t){return e.apply(this,arguments)}}(),G=function(){q.ref("/users/".concat(ce(a.email),"/chats/").concat(ce(y),"/messages")).set(g[ce(y)].messages),q.ref("/users/".concat(ce(y),"/chats/").concat(ce(a.email),"/messages")).set(g[ce(y)].messages)};return a&&!P&!L?Object(d.jsx)(j.Provider,{value:{user:a,signOut:function(){V.signOut(),n(null),O([]),N([]),m([]),k(""),localStorage.removeItem("USER_DATA")},addChat:B,chats:v,chatsEmails:h,userMessages:g,value:A,activeChat:y,onChatSelect:function(e){k((function(t){return t===e?"":e}))},parseEmail:ce,resetChat:function(e){N((function(t){return t[ce(e)].messages=[],t})),q.ref("/users/".concat(ce(a.email),"/chats/").concat(ce(e),"/messages")).remove(),q.ref("/users/".concat(ce(e),"/chats/").concat(ce(a.email),"/messages")).remove()},deleteChat:function(e){var t=Object(s.a)(h);t.splice(t.indexOf(ce(e)),1),k(""),m(t),q.ref("/users/".concat(ce(a.email),"/chats/").concat(ce(e))).remove(),q.ref("/users/".concat(ce(e),"/chats/").concat(ce(a.email))).remove()},viewMessageInfo:function(e){var t=g[ce(y)].messages.find((function(t){return t.id===e})),a=t.date,n=t.content,c=t.provider;alert("Content: ".concat(n,"\nDate: ").concat(a,"\nWriter: ").concat(c))},deleteMessage:function(e){var t=g[ce(y)].messages,n=t.findIndex((function(t){return t.id===e}));t[n].provider===a.email&&(t.splice(n,1),N(),M((function(e){return e+1})),G())},addMessage:function(e){e&&(N((function(t){return t[ce(y)].messages.push({id:Object(C.a)(),content:e,date:(new Date).toString(),provider:a.email}),t})),M((function(e){return e+1})),G())}},children:Object(d.jsxs)($.a,{elevation:10,className:"app",children:[Object(d.jsx)(S,{}),Object(d.jsx)(X,{})]})}):Object(d.jsx)(ne,{onSignIn:J,isLoading:P,error:L})}a(76);c.a.render(Object(d.jsx)(se,{}),document.getElementById("root"))}},[[77,1,2]]]);
//# sourceMappingURL=main.24a353f0.chunk.js.map